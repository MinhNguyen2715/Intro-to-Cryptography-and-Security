import math

def read_json_data(data: dict):
    """Read data from JSON format"""
    p = data["p"]
    q = data["q"]
    g = data["g"]
    y = data["y"]
    sig1 = data["sig1"]
    sig2 = data["sig2"]
    return p, q, g, y, sig1, sig2

def recover_private_key(data: dict):
    """Solve system of linear equation to get d"""
    _, q, _, _, sig1, sig2 = read_json_data(data)

    x1 = sig1["x"]
    r1 = sig1["r"]
    s1 = sig1["s"]

    x2 = sig2["x"]
    r2 = sig2["r"]
    s2 = sig2["s"]

    det = (s1 * r2 - s2 * r1) % q
    if math.gcd(det, q) != 1:
        raise ValueError("")
    det_inv = pow(det, -1, q)

    # Cramer's system: Ax = B, x = [k ,d]
    # RHS
    b1 = x1
    b2 = (x2 - s2) % q

    # det of A_d
    d_num = (s1 * b2 - s2 * b1) % q

    # d = det_A_d * (det_A)^-1
    d = (det_inv * d_num) % q

    return d

if __name__ == "__main__":
    # Level 1: Small number
    # Expected: d = 21
    test_data = {
        "p": 467,
        "q": 233,
        "g": 225,
        "y": 252,
        "sig1": {
            "x": 151,
            "r": 47,
            "s": 94
        },
        "sig2": {
            "x": 46,
            "r": 301,
            "s": 133
        }
    }
    test = recover_private_key(test_data)
    print("Test result: ",test)

    # Level 2: Big number
    big_data = {
         "p": 21617692091972978742235166480742862532407156107636789231276846348871806805459265097334588112742408477197337174109396234828782656654798240250161457460539107,
         "q": 10808846045986489371117583240371431266203578053818394615638423174435903402729632548667294056371204238598668587054698117414391328327399120125080728730269553,
         "g": 8143651548100947843382350751344608024514508427736080091651634668538984233972621950778992546927258791789679928270857984915727688029043622808767719120145074,
         "y": 5337741482750797476261738705281015195709371216778881633606734128234762113049696886434515870887750677662738177268317668593170743480677686307821740168619786,
         "sig1": {
             "x": 700495879643683054817375080824786066232130521319731986884895012040965686006464788788827750493322383874538420521981138868303353190260424143057326776757373,
             "r": 21442891835433236617485085355436041175289688399925396587145558330757037993993280456584809628106791530886244611686592667399267838111887731372657587978697768,
             "s": 9578212581237917941432747084881128196179354508788807162140588617803641561276876172329278898846222343300996748745568300211454084744121492123145984865114214
        },
         "sig2": {
             "x": 7948944228808646192883566297506348894200221948529547265350717153384406128671428403594981779545621945879049610232293959849646101244254283491779346594596773,
             "r": 14237018484274987810297519540781222437887587222087300824402427487699647704800632115982276060742478686125469062670076006247438209565913707179757512193326796,
             "s": 10622307882903918298403370294837054194996446050344436880766181995133143646783877563956424755967519418900317082840363586379948106787342394514047484044936934
        }
    }
    result = recover_private_key(big_data)
    print("Result: ", result)



